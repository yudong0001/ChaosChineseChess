
<script type="text/javascript" src="/javascripts/jquery.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){
    
    var EMPTY_NAME = 'ç©º';

    var rowsCount = <%=rowsCount%>;
    var columnsCount = <%=columnsCount%>;
    var cellSize = <%=cellSize%>;

    function getCellFromMami(jqMami) {
        var x = jqMami.css('left');
        var y = jqMami.css('top');
        x = x.substring(0, x.length - 2) / cellSize;
        y = y.substring(0, y.length - 2) / cellSize;
        return {x: x, y: y};
    }

    function updateMamiForCell(jqMami, cell) {
        if (cell.hidden) {
            return;
        } else {
            jqMami.addClass('discovered');
        }
        if (cell.name == EMPTY_NAME) {
            jqMami.removeClass('red discovered selected').addClass('discovered empty').text('');
        } else {
            jqMami.removeClass('red black').addClass(cell.camp).text(cell.name);
        }
    }

    /*$.post('/play', {x:1, y:1}, function(data){
        console.log('result for post to /play: %o',data);
    });*/

    $('.cell').click(function(e){
        console.log('cell click called: %o',e);//***************

        var clicked = $(e.currentTarget);
        var cellpos = getCellFromMami(clicked);

        $.post('/play',cellpos, function(data){
            console.log('result after click: %o',data);
            switch (data.action){
                case 'discover':clicked.addClass('discovered ' + data.cell.camp).text(data.cell.name);break;
                case 'select':clicked.addClass('selected');break;
                case 'unselect':$('.cell').removeClass('selected');break;
                case 'exchange':$('.cell').removeClass('selected');clicked.addClass('selected');break;
                case 'kill':
                    clicked.removeClass(data.killed.camp).addClass(data.killer.camp).text(data.killer.name);
                    $('#cell'+data.killer.y+data.killer.x).removeClass('selected '+data.killer.camp).text(" ");
                    break;
            }
        });
    });

    $('.cell').each(function(i, o){
        var jqMami = $(o);
        updateMamiForCell(jqMami, getCellFromMami(jqMami));
    });

});
</script>